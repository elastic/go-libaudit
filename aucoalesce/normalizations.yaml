---
# Macros declares some YAML anchors that can be referenced for some common
# object type normalizations like user-session, socket, or process.
macros:
  - &defaults
    subject:
      primary: auid
      secondary: uid
    how: [exe, comm]

  - &macro-user-session
    subject:
      primary: auid
      secondary: [acct, id, uid]
    object:
      primary: terminal
      secondary: [addr, hostname]
      what: user-session
    how: [exe, terminal]

  - &macro-socket
    <<: *defaults
    object:
      primary: [addr, path]
      secondary: port
      what: socket

  - &macro-process
    <<: *defaults
    object:
      primary: [cmd, exe, comm]
      secondary: pid
      what: process
    how: terminal

  - &ecs-iam
    category: iam
    type: info

  - &ecs-auth
    category: authentication
    type: info

  - &ecs-host
    category: host
    type: info

  - &ecs-process
    category: process
    type: info

  - &ecs-file
    category: file
    type: info

  - &ecs-network
    category: network
    type:
      - connection
      - info

# Normalizations is a list of declarations specifying how to normalize the data
# contained in an event. The normalization can be applied based on the syscall
# name (e.g. connect, open) or based on the record type (e.g. USER_LOGIN).
# No two normalizations can apply to the same syscall or record type. This
# will result in a failure at load time.
#
# Each normalization should specify:
#   action - what happened
#   actor  - who did this or who triggered the event
#   object - what was the "thing" involved in the action (e.g. process, socket)
#   how    - how was the action performed (e.g. exe or terminal)
normalizations:
  - ecs: *ecs-process
    syscalls:
      - '*' # this is a catch all
  - action: opened-file
    object:
      what: file
    syscalls:
      - creat
    ecs:
      <<: *ecs-file
      type: creation
  - action: opened-file
    object:
      what: file
    syscalls:
      - fallocate
      - truncate
      - ftruncate
    ecs:
      <<: *ecs-file
      # technically you can truncate a file to the same length
      # but regardless, we consider this a change
      type: change
  - action: opened-file
    object:
      what: file
    syscalls:
      - open
      - openat
      - readlink
      - readlinkat
    ecs: *ecs-file
  - action: read-file
    object:
      what: file
    syscalls:
      - read
    ecs: *ecs-file
  - action: changed-file-attributes-of
    object:
      what: file
    syscalls:
      - setxattr
      - fsetxattr
      - lsetxattr
      - removexattr
      - fremovexattr
      - lremovexattr
    ecs:
      <<: *ecs-file
      type: change
  - action: changed-file-permissions-of
    object:
      what: file
    syscalls:
      - chmod
      - fchmod
      - fchmodat
    ecs:
      <<: *ecs-file
      type: change
  - action: changed-file-ownership-of
    object:
      what: file
    syscalls:
      - chown
      - fchown
      - fchownat
      - lchown
    ecs:
      <<: *ecs-file
      type: change
  - action: loaded-kernel-module
    object:
      what: file
      primary: name
    record_types:
      - KERN_MODULE
    syscalls:
      - finit_module
      - init_module
    ecs:
      category: driver
      type: start
  - action: unloaded-kernel-module
    object:
      what: file
    syscalls:
      - delete_module
    ecs:
      <<: *ecs-file
      type: end
  - action: created-directory
    object:
      what: file
      path_index: 1
    syscalls:
      - mkdir
      - mkdirat
    ecs:
      category: file
      type: create
  - action: mounted
    object:
      what: filesystem
      path_index: 1
    syscalls:
      - mount
    ecs:
      <<: *ecs-file
      # since a new mount appears on the system
      # we consider this a high-level "creation" event
      type: creation
  - action: renamed
    object:
      what: file
      path_index: 2
    syscalls:
      - rename
      - renameat
      - renameat2
    ecs:
      <<: *ecs-file
      type: change
  - action: checked-metadata-of
    object:
      what: file
    syscalls:
      - access
      - faccessat
      - newfstatat
      - stat
      - fstat
      - lstat
      - stat64
      - getxattr
      - lgetxattr
      - fgetxattr
    ecs: *ecs-file
  - action: checked-filesystem-metadata-of
    object:
      what: filesystem
    syscalls:
      - statfs
      - fstatfs
    ecs: *ecs-file
  - action: symlinked
    object:
      what: file
    syscalls:
      - symlink
      - symlinkat
    ecs:
      <<: *ecs-file
      # "creation" since we're creating a new file system
      # entry for the symlink
      type: creation
  - action: unmounted
    object:
      what: filesystem
    syscalls:
      - umount2
    ecs:
      <<: *ecs-file
      # "deletion" to mirror the "creation" of the mount
      type: deletion
  - action: deleted
    object:
      what: file
    syscalls:
      - rmdir
      - unlink
      - unlinkat
    ecs:
      <<: *ecs-file
      type: deletion
  - action: changed-timestamp-of
    object:
      what: file
    syscalls:
      - utime
      - utimes
      - futimesat
      - futimens
      - utimensat
    ecs: *ecs-file
  - action: executed
    object:
      what: file
    syscalls:
      - execve
      - execveat
    ecs:
      <<: *ecs-process
      type: creation
  - action: listen-for-connections
    object:
      what: socket
    syscalls:
      - listen
    ecs:
      <<: *ecs-network
      type: start
  - action: accepted-connection-from
    object:
      what: socket
    syscalls:
      - accept
      - accept4
    ecs:
      <<: *ecs-network
      type:
        - connection
        - start
  - action: bound-socket
    object:
      what: socket
    syscalls:
      - bind
    ecs:
      <<: *ecs-network
      type: start
  - action: connected-to
    object:
      what: socket
    syscalls:
      - connect
    ecs:
      <<: *ecs-network
      type:
        - connection
        - start
  - action: received-from
    object:
      what: socket
    syscalls:
      - recvfrom
      - recvmsg
    ecs:
      <<: *ecs-network
  - action: sent-to
    object:
      what: socket
    syscalls:
      - sendto
      - sendmsg
    ecs:
      <<: *ecs-network
  - action: killed-pid
    object:
      what: process
    syscalls:
      - kill
      - tkill
      - tgkill
    ecs:
      <<: *ecs-process
      type: end
  - action: changed-identity-of
    object:
      what: process
    how: syscall
    syscalls:
      - setuid
      - seteuid
      - setfsuid
      - setreuid
      - setresuid
      - setgid
      - setegid
      - setfsgid
      - setregid
      - setresgid
    ecs:
      <<: *ecs-process
      type: change
  - action: changed-system-time
    object:
      what: system
    syscalls:
      - settimeofday
      - clock_settime
      - stime
      - adjtimex
    ecs:
      <<: *ecs-host
      type: change
  - action: make-device
    object:
      what: file
    syscalls:
      - mknod
      - mknodat
    ecs:
      <<: *ecs-file
      type: creation
  - action: changed-system-name
    object:
      what: system
    syscalls:
      - sethostname
      - setdomainname
    ecs:
      <<: *ecs-host
      type: change
  - action: allocated-memory
    object:
      what: memory
    syscalls:
      - mmap
      - brk
    ecs: *ecs-process
  - action: adjusted-scheduling-policy-of
    object:
      what: process
    how: syscall
    syscalls:
      - sched_setparam
      - sched_setscheduler
      - sched_setattr
    ecs:
      <<: *ecs-process
      type: change

  # Record type normalizations
  # Useful links:
  # https://raw.githubusercontent.com/torvalds/linux/v4.16/include/uapi/linux/audit.h
  # https://raw.githubusercontent.com/linux-audit/audit-userspace/4d933301b1835cafa08b9e9ef705c8fb6c96cb62/lib/libaudit.h
  # https://www.elastic.co/guide/en/ecs/current/ecs-allowed-values-event-category.html

  # IAM related events

  # AUDIT_ACCT_LOCK - User's account locked by admin
  - record_types: ACCT_LOCK
    action: locked-account
    ecs:
      <<: *ecs-iam
      type:
        - user
        - info
  # AUDIT_ACCT_UNLOCK - User's account unlocked by admin
  - record_types: ACCT_UNLOCK
    action: unlocked-account
    ecs:
      <<: *ecs-iam
      type:
        - user
        - info
  # AUDIT_ADD_GROUP - Group account added
  - record_types: ADD_GROUP
    action: added-group-account-to
    object:
      primary: [id, acct]
      what: account
    ecs:
      <<: *ecs-iam
      type:
        - group
        - creation
  # AUDIT_ADD_USER - User account added
  - record_types: ADD_USER
    action: added-user-account
    object:
      primary: [id, acct]
      what: account
    ecs:
      <<: *ecs-iam
      type:
        - user
        - creation
  # AUDIT_DEL_GROUP - Group account deleted
  - record_types: DEL_GROUP
    action: deleted-group-account-from
    object:
      primary: [id, acct]
      what: account
    ecs:
      <<: *ecs-iam
      type:
        - group
        - deletion
  # AUDIT_DEL_USER - User account deleted
  - record_types: DEL_USER
    action: deleted-user-account
    object:
      primary: [id, acct]
      what: account
    ecs:
      <<: *ecs-iam
      type:
        - user
        - deletion
  # AUDIT_GRP_MGMT - Group account attr was modified
  - record_types: GRP_MGMT
    action: modified-group-account
    object:
      primary: [id, acct]
      what: account
    ecs:
      <<: *ecs-iam
      type:
        - group
        - change
  # AUDIT_ROLE_ASSIGN - Admin assigned user to role
  - record_types: ROLE_ASSIGN
    action: assigned-user-role-to
    object:
      primary: [id, acct]
      what: account
    ecs:
      <<: *ecs-iam
      type:
        - user
        - change
  # AUDIT_ROLE_MODIFY - Admin modified a role
  - record_types: ROLE_MODIFY
    action: modified-role
    ecs:
      <<: *ecs-iam
      type:
        - change
  # AUDIT_ROLE_REMOVE - Admin removed user from role
  - record_types: ROLE_REMOVE
    action: removed-use-role-from
    object:
      primary: [id, acct]
      what: account
    ecs:
      <<: *ecs-iam
      type:
        - user
        - change
  # AUDIT_USER_MGMT - User acct attribute change
  - <<: *macro-user-session
    record_types: USER_MGMT
    action: modified-user-account
    ecs:
      <<: *ecs-iam
      type:
        - user
        - change
  # AUDIT_USER_CHAUTHTOK - User acct password or pin changed
  - <<: *macro-user-session
    record_types: USER_CHAUTHTOK
    action: changed-password
    ecs:
      <<: *ecs-iam
      type:
        - user
        - change
  # AUDIT_GRP_CHAUTHTOK - Group acct password or pin changed
  - <<: *macro-user-session
    record_types: GRP_CHAUTHTOK
    action: changed-group-password
    object:
      primary: acct
      what: user-session
    ecs:
      <<: *ecs-iam
      type:
        - group
        - change

  # Authentication related events

  # AUDIT_CRED_ACQ - User credential acquired
  - <<: *macro-user-session
    record_types: CRED_ACQ
    action: acquired-credentials
    ecs: *ecs-auth
  # AUDIT_CRED_DISP - User credential disposed
  - <<: *macro-user-session
    record_types: CRED_DISP
    action: disposed-credentials
    ecs: *ecs-auth
  # AUDIT_CRED_REFR - User credential refreshed
  - <<: *macro-user-session
    record_types: CRED_REFR
    action: refreshed-credentials
    ecs: *ecs-auth
  # AUDIT_GRP_AUTH - Authentication for group password
  - record_types: GRP_AUTH
    action: authenticated-to-group
    ecs: *ecs-auth
  # AUDIT_LOGIN - Define the login id and information
  - record_types: LOGIN
    action: changed-login-id-to
    subject:
      primary: [old_auid, old-auid]
      secondary: uid
    object:
      primary: auid
      what: user-session
    ecs:
      <<: *ecs-auth
      type: start
  # AUDIT_USER_ACCT - User system access authorization
  - <<: *macro-user-session
    record_types: USER_ACCT
    action: was-authorized
    ecs: *ecs-auth
  # AUDIT_USER_AUTH - User system access authentication
  - <<: *macro-user-session
    record_types: USER_AUTH
    action: authenticated
    ecs: *ecs-auth
  # AUDIT_USER_END - User session end
  - <<: *macro-user-session
    record_types: USER_END
    action: ended-session
    ecs: *ecs-auth
  # AUDIT_USER_ERR - User acct state error
  - <<: *macro-user-session
    record_types: USER_ERR
    action: error
    source_ip: [addr]
    ecs: *ecs-auth
  # AUDIT_USER_LOGIN - User has logged in
  - <<: *macro-user-session
    record_types: USER_LOGIN
    action: logged-in
    source_ip: [addr]
    ecs:
      <<: *ecs-auth
      type: start
  # AUDIT_USER_LOGOUT - User has logged out
  - <<: *macro-user-session
    record_types: USER_LOGOUT
    action: logged-out
    ecs:
      <<: *ecs-auth
      type: end
  # AUDIT_USER_ROLE_CHANGE - User changed to a new role
  - <<: *macro-user-session
    record_types: USER_ROLE_CHANGE
    action: changed-role-to
    object:
      primary: selected-context
      what: user-session
  # AUDIT_USER_START - User session start
  - <<: *macro-user-session
    record_types: USER_START
    action: started-session
    source_ip: [addr]
    ecs: *ecs-auth

  # Host virtualization events

  # AUDIT_VIRT_CONTROL - Start, Pause, Stop VM
  - record_types: VIRT_CONTROL
    action: issued-vm-control
    object:
      primary: op
      secondary: vm
      what: virtual-machine
    ecs: *ecs-host
  # AUDIT_VIRT_CREATE - Creation of guest image
  - record_types: VIRT_CREATE
    action: created-vm-image
    ecs: *ecs-host
  # AUDIT_VIRT_DESTROY - Destruction of guest image
  - record_types: VIRT_DESTROY
    action: deleted-vm-image
    ecs: *ecs-host
  # AUDIT_VIRT_INTEGRITY_CHECK - Guest integrity results
  - record_types: VIRT_INTEGRITY_CHECK
    action: checked-integrity-of
    ecs: *ecs-host
  # AUDIT_VIRT_MACHINE_ID - Binding of label to VM
  - record_types: VIRT_MACHINE_ID
    action: assigned-vm-id
    object:
      primary: vm
      what: virtual-machine
    ecs: *ecs-host
  # AUDIT_VIRT_MIGRATE_IN - Inbound guest migration info
  - record_types: VIRT_MIGRATE_IN
    action: migrated-vm-from
    ecs: *ecs-host
  # AUDIT_VIRT_MIGRATE_OUT - Outbound guest migration info
  - record_types: VIRT_MIGRATE_OUT
    action: migrated-vm-to
    ecs: *ecs-host
  # AUDIT_VIRT_RESOURCE - Resource assignment
  - record_types: VIRT_RESOURCE
    action: assigned-vm-resource
    object:
      primary: resrc
      secondary: vm
      what: virtual-machine
    ecs: *ecs-host

  # Userspace process events

  # AUDIT_CHGRP_ID - User space group ID changed
  - record_types: CHGRP_ID
    action: changed-group
    ecs:
      <<: *ecs-process
      type: change
  # AUDIT_CHUSER_ID - Changed user ID supplemental data
  - record_types: CHUSER_ID
    action: changed-user-id
    ecs:
      <<: *ecs-process
      type: change
  # AUDIT_TEST - Used for test success messages
  - record_types: TEST
    action: sent-test
    ecs: *ecs-process
  # AUDIT_TRUSTED_APP - Trusted app msg - freestyle text
  - record_types: TRUSTED_APP
    action: unknown
    ecs: *ecs-process
  # AUDIT_USER_CMD - User shell command and args
  - record_types: USER_CMD
    action: ran-command
    object:
      primary: cmd
      what: process
    description: >
      These messages are from user-space apps, like sudo, that log commands
      being run by a user. The uid contained in these messages is user's UID at
      the time the command was run. It is not the "target" UID used to run the
      command, which is normally root.
    ecs:
      <<: *ecs-process
      type: start

  # Host-level events

  # AUDIT_SYSTEM_BOOT - System boot
  - record_types: SYSTEM_BOOT
    action: booted-system
    object:
      what: system
    ecs:
      <<: *ecs-host
      type: start
  # AUDIT_SYSTEM_RUNLEVEL - System runlevel change
  - record_types: SYSTEM_RUNLEVEL
    action: changed-to-runlevel
    object:
      primary: new-level
      what: system
    ecs:
      <<: *ecs-host
      type: change
  # AUDIT_SYSTEM_SHUTDOWN - System shutdown
  - record_types: SYSTEM_SHUTDOWN
    action: shutdown-system
    object:
      what: system
    ecs:
      <<: *ecs-host
      type: end

  # Service-level events

  # AUDIT_SERVICE_START - Service (daemon) start
  - record_types: SERVICE_START
    action: started-service
    object:
      primary: unit
      what: service
    ecs:
      <<: *ecs-process
      type: start
  # AUDIT_SERVICE_STOP - Service (daemon) stop
  - record_types: SERVICE_STOP
    action: stopped-service
    object:
      primary: unit
      what: service
    ecs:
      <<: *ecs-process
      type: stop

  # Auditd internal events

  # AUDIT_CONFIG_CHANGE - Audit system configuration change
  - record_types: CONFIG_CHANGE
    action: changed-audit-configuration
    object:
      primary:
        [op, key, audit_enabled, audit_pid, audit_backlog_limit, audit_failure]
      what: audit-config
    ecs:
      <<: *ecs-process
      type: change
  # AUDIT_DAEMON_ABORT - Daemon error stop record
  - record_types: DAEMON_ABORT
    action: aborted-auditd-startup
    object:
      what: service
    ecs:
      <<: *ecs-process
      type: stop
  # AUDIT_DAEMON_ACCEPT - Auditd accepted remote connection
  - record_types: DAEMON_ACCEPT
    action: remote-audit-connected
    object:
      what: service
    ecs:
      <<: *ecs-network
      type:
        - connection
        - start
  # AUDIT_DAEMON_CLOSE - Auditd closed remote connection
  - record_types: DAEMON_CLOSE
    action: remote-audit-disconnected
    object:
      what: service
    ecs:
      <<: *ecs-network
      type:
        - connection
        - start
  # AUDIT_DAEMON_CONFIG - Daemon config change
  - record_types: DAEMON_CONFIG
    action: changed-auditd-configuration
    object:
      what: service
    ecs:
      <<: *ecs-process
      type: stop
  # AUDIT_DAEMON_END - Daemon normal stop record
  - record_types: DAEMON_END
    action: shutdown-audit
    object:
      what: service
    ecs:
      <<: *ecs-process
      type: stop
  # AUDIT_DAEMON_ERR - Auditd internal error
  - record_types: DAEMON_ERR
    action: audit-error
    object:
      what: service
    ecs: *ecs-process
  # AUDIT_DAEMON_RECONFIG - Auditd should reconfigure
  - record_types: DAEMON_RECONFIG
    action: reconfigured-auditd
    object:
      what: service
    ecs:
      <<: *ecs-process
      type: change
  # AUDIT_DAEMON_RESUME - Auditd should resume logging
  - record_types: DAEMON_RESUME
    action: resumed-audit-logging
    object:
      what: service
    ecs:
      <<: *ecs-process
      type: change
  # AUDIT_DAEMON_ROTATE - Auditd should rotate logs
  - record_types: DAEMON_ROTATE
    action: rotated-audit-logs
    object:
      what: service
    ecs:
      <<: *ecs-process
      type: change
  # AUDIT_DAEMON_START - Daemon startup record
  - record_types: DAEMON_START
    action: started-audit
    object:
      what: service
    ecs:
      <<: *ecs-process
      type: start
  # AUDIT_KERNEL - Asynchronous audit record. NOT A REQUEST.
  - record_types: KERNEL
    action: initialized-audit-subsystem
    ecs: *ecs-process

  # Configuration change events

  # AUDIT_USYS_CONFIG - User space system config change
  - record_types: USYS_CONFIG
    action: changed-configuration
    object:
      primary: op
      what: system
  # AUDIT_NETFILTER_CFG - Netfilter chain modifications
  - record_types: NETFILTER_CFG
    action: loaded-firewall-rule-to
    object:
      primary: table
      what: firewall
  # AUDIT_FEATURE_CHANGE - audit log listing feature changes
  - record_types: FEATURE_CHANGE
    action: changed-audit-feature
    object:
      primary: feature
      what: system
  # AUDIT_REPLACE - Replace auditd if this packet unanswerd

  # TTY events

  - record_types:
      # AUDIT_TTY - Input on an administrative TTY
      - TTY
      # AUDIT_USER_TTY - Non-ICANON TTY input meaning
      - USER_TTY
    action: typed
    object:
      primary: data
      what: keystrokes
    how: [comm, exe]

  # Policy events

  # AUDIT_AVC - SE Linux avc denial or grant (selinux)
  - record_types: AVC
    action: violated-selinux-policy
    subject:
      primary: scontext
    object:
      primary: tcontext
      secondary: tclass
    has_fields:
      - seresult
  # AUDIT_AVC - SE Linux avc denial or grant (apparmor)
  - record_types: AVC
    action: violated-apparmor-policy
    object:
      primary: operation
      secondary: [requested_mask, denied_mask, capname]
      what: policy
    has_fields:
      - apparmor
  # AUDIT_FS_RELABEL - Filesystem relabeled
  - record_types: FS_RELABEL
    action: relabeled-filesystem
    object:
      what: mac-config
  # AUDIT_LABEL_LEVEL_CHANGE - Object's level was changed
  - record_types: LABEL_LEVEL_CHANGE
    action: modified-level-of
    object:
      primary: printer
      what: printer
  # AUDIT_LABEL_OVERRIDE - Admin is overriding a label
  - record_types: LABEL_OVERRIDE
    action: overrode-label-of
    object:
      what: mac-config
  # AUDIT_MAC_CHECK - User space MAC decision results
  - record_types: MAC_CHECK
    action: mac-permission
  # AUDIT_MAC_CONFIG_CHANGE - Changes to booleans
  - record_types: MAC_CONFIG_CHANGE
    action: changed-selinux-boolean
    object:
      primary: bool
      what: mac-config
  # AUDIT_MAC_POLICY_LOAD - Policy file load
  - record_types: MAC_POLICY_LOAD
    action: loaded-selinux-policy
    object:
      what: mac-config
  # AUDIT_MAC_STATUS - Changed enforcing,permissive,off
  - record_types: MAC_STATUS
    action: changed-selinux-enforcement
    object:
      primary: enforcing
      what: mac-config
  # AUDIT_USER_AVC - User space avc message
  - record_types: USER_AVC
    action: access-permission
  # AUDIT_USER_MAC_CONFIG_CHANGE - Change made to MAC policy
  - record_types: USER_MAC_CONFIG_CHANGE
    action: changed-mac-configuration
    object:
      what: mac-config
  # AUDIT_USER_MAC_POLICY_LOAD - Userspc daemon loaded polic
  - record_types: USER_MAC_POLICY_LOAD
    action: loaded-mac-policy
    object:
      what: mac-config
  # AUDIT_USER_SELINUX_ERR - SE Linux user space error
  - record_types: USER_SELINUX_ERR
    action: access-error
  # AUDIT_SECCOMP - Secure Computing event
  - record_types: SECCOMP
    action: violated-seccomp-policy
    object:
      primary: syscall
      what: process
  # AUDIT_SELINUX_ERR - Internal SE Linux Errors
  - action: caused-mac-policy-error
    object:
      what: system
    record_types: SELINUX_ERR
  # AUDIT_APPARMOR_ALLOWED
  # AUDIT_APPARMOR_DENIED
  # AUDIT_APPARMOR_ERROR
  # AUDIT_AVC_PATH - dentry, vfsmount pair from avc
  # AUDIT_APPARMOR_AUDIT
  # AUDIT_APPARMOR_HINT
  # AUDIT_APPARMOR_STATUS
  # AUDIT_APPARMOR_ERROR
  # AUDIT_DEV_ALLOC - Device was allocated
  # AUDIT_DEV_DEALLOC - Device was deallocated
  # AUDIT_MAC_UNLBL_ALLOW - NetLabel: allow unlabeled traffic
  # AUDIT_MAC_CIPSOV4_ADD - NetLabel: add CIPSOv4 DOI entry
  # AUDIT_MAC_CIPSOV4_DEL - NetLabel: del CIPSOv4 DOI entry
  # AUDIT_MAC_MAP_ADD - NetLabel: add LSM domain mapping
  # AUDIT_MAC_MAP_DEL - NetLabel: del LSM domain mapping
  # AUDIT_MAC_IPSEC_EVENT - Audit an IPSec event
  # AUDIT_MAC_UNLBL_STCADD - NetLabel: add a static label
  # AUDIT_MAC_UNLBL_STCDEL - NetLabel: del a static label
  # AUDIT_MAC_CALIPSO_ADD - NetLabel: add CALIPSO DOI entry
  # AUDIT_MAC_CALIPSO_DEL - NetLabel: del CALIPSO DOI entry
  # AUDIT_USER_LABELED_EXPORT - Object exported with label
  # AUDIT_USER_UNLABELED_EXPORT - Object exported without label

  # Crypto events

  - <<: *macro-user-session
    action: negotiated-crypto-key
    object:
      primary: fp
      secondary: [addr, hostname]
      what: user-session
    record_types: CRYPTO_KEY_USER
    source_ip: [addr]
    ecs: *ecs-process
  - action: crypto-officer-logged-in
    record_types: CRYPTO_LOGIN
  - action: crypto-officer-logged-out
    record_types: CRYPTO_LOGOUT
    ecs: *ecs-process
  - <<: *macro-user-session
    action: started-crypto-session
    object:
      primary: addr
      secondary: [rport]
    record_types: CRYPTO_SESSION
    source_ip: [addr]
    ecs: *ecs-process
  - action: access-result
    record_types: DAC_CHECK

  # Anomalies

  # AUDIT_ANOM_ABEND - Process ended abnormally
  - record_types: ANOM_ABEND
    action: crashed-program
    object:
      primary: [comm, exe]
      secondary: pid
      what: process
    how: sig
    ecs:
      # consider adding an anomaly category when we introduce
      # to ECS
      <<: *ecs-process
      type: end
  # AUDIT_ANOM_EXEC - Execution of file
  - record_types: ANOM_EXEC
    action: attempted-execution-of-forbidden-program
    object:
      primary: cmd
      what: process
    how: terminal
    ecs:
      # consider adding an anomaly category when we introduce
      # to ECS
      <<: *ecs-process
      type: start
  # AUDIT_ANOM_LINK - Suspicious use of file links
  - record_types: ANOM_LINK
    action: used-suspcious-link
  # AUDIT_ANOM_LOGIN_FAILURES - Failed login limit reached
  - <<: *macro-user-session
    record_types: ANOM_LOGIN_FAILURES
    action: failed-log-in-too-many-times-to
  # AUDIT_ANOM_LOGIN_LOCATION - Login from forbidden location
  - <<: *macro-user-session
    record_types: ANOM_LOGIN_LOCATION
    action: attempted-log-in-from-unusual-place-to
  # AUDIT_ANOM_LOGIN_SESSIONS - Max concurrent sessions reached
  - <<: *macro-user-session
    record_types: ANOM_LOGIN_SESSIONS
    action: opened-too-many-sessions-to
  # AUDIT_ANOM_LOGIN_TIME - Login attempted at bad time
  - <<: *macro-user-session
    record_types: ANOM_LOGIN_TIME
    action: attempted-log-in-during-unusual-hour-to
  # AUDIT_ANOM_PROMISCUOUS - Device changed promiscuous mode
  - record_types: ANOM_PROMISCUOUS
    action: changed-promiscuous-mode-on-device # Could be entered or exited based on prom field.
    object:
      primary: dev
      what: network-device
  # AUDIT_ANOM_RBAC_INTEGRITY_FAIL - RBAC file integrity failure
  - record_types: ANOM_RBAC_INTEGRITY_FAIL
    action: tested-file-system-integrity-of
    object:
      primary: hostname
      what: filesystem
  # AUDIT_ANOM_LOGIN_ACCT - Login attempted to watched acct
  # AUDIT_ANOM_MAX_DAC - Max DAC failures reached
  # AUDIT_ANOM_MAX_MAC - Max MAC failures reached
  # AUDIT_ANOM_AMTU_FAIL - AMTU failure
  # AUDIT_ANOM_RBAC_FAIL - RBAC self test failure
  # AUDIT_ANOM_CRYPTO_FAIL - Crypto system test failure
  # AUDIT_ANOM_MK_EXE - Make an executable
  # AUDIT_ANOM_ACCESS_FS - Access of file or dir
  # AUDIT_ANOM_ADD_ACCT - Adding an acct
  # AUDIT_ANOM_DEL_ACCT - Deleting an acct
  # AUDIT_ANOM_MOD_ACCT - Changing an acct
  # AUDIT_ANOM_ROOT_TRANS - User became root
  # AUDIT_ANOM_LOGIN_SERVICE - Service acct attempted login

  # Anomaly responses

  # AUDIT_RESP_ANOMALY - Anomaly not reacted to
  # AUDIT_RESP_ALERT - Alert email was sent
  # AUDIT_RESP_KILL_PROC - Kill program
  # AUDIT_RESP_TERM_ACCESS - Terminate session
  # AUDIT_RESP_ACCT_REMOTE - Acct locked from remote access
  # AUDIT_RESP_ACCT_LOCK_TIMED - User acct locked for time
  # AUDIT_RESP_ACCT_UNLOCK_TIMED - User acct unlocked from time
  # AUDIT_RESP_ACCT_LOCK - User acct was locked
  # AUDIT_RESP_TERM_LOCK - Terminal was locked
  # AUDIT_RESP_SEBOOL - Set an SE Linux boolean
  # AUDIT_RESP_EXEC - Execute a script
  # AUDIT_RESP_SINGLE - Go to single user mode
  # AUDIT_RESP_HALT - take the system down
  # AUDIT_RESP_ORIGIN_BLOCK - Address blocked by iptables
  # AUDIT_RESP_ORIGIN_BLOCK_TIMED - Address blocked for time

  # Audit rule events

  # AUDIT_SYSCALL - Syscall event
  # AUDIT_PATH - Filename path information
  # AUDIT_IPC - IPC record
  # AUDIT_SOCKETCALL - sys_socketcall arguments
  # AUDIT_SOCKADDR - sockaddr copied as syscall arg
  # AUDIT_CWD - Current working directory
  # AUDIT_EXECVE - execve arguments
  # AUDIT_IPC_SET_PERM - IPC new permissions record type
  # AUDIT_MQ_OPEN - POSIX MQ open record type
  # AUDIT_MQ_SENDRECV- POSIX MQ send/receive record type
  # AUDIT_MQ_NOTIFY - POSIX MQ notify record type
  # AUDIT_MQ_GETSETATTR - POSIX MQ get/set attribute record type
  # AUDIT_FD_PAIR - audit record for pipe/socketpair
  # AUDIT_OBJ_PID - ptrace target
  # AUDIT_BPRM_FCAPS - Information about fcaps increasing perms
  # AUDIT_CAPSET - Record showing argument to sys_capset
  # AUDIT_MMAP - Record showing descriptor and flags in mmap
  # AUDIT_NETFILTER_PKT - Packets traversing netfilter chains

  # Integrity checks

  # AUDIT_INTEGRITY_DATA - Data integrity verification
  # AUDIT_INTEGRITY_METADATA - Metadata integrity verification
  # AUDIT_INTEGRITY_STATUS - Integrity enable status
  # AUDIT_INTEGRITY_HASH - Integrity HASH type
  # AUDIT_INTEGRITY_PCR - PCR invalidation msgs
  # AUDIT_INTEGRITY_RULE - Policy rule

  # Various

  # AUDIT_USER - Message from userspace -- deprecated
  - record_types: USER
    action: sent-message
    object:
      primary: addr
